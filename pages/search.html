<div id="search-error" class="alert alert-error hidden">
  <span class="label label-info">FATAL</span><p class="text-error"></p>
</div>

<div id="search-result" class="hidden">
  <center><div id="search-ProcessingTook"><h3><span class="name">ProcessingTook: </span><span class="value"></span></h3></div></center>

  <div class="accordion botspacer40" id="search-tab">

    <div id="copy-search-tab" class="accordion-group hidden">
      <div class="accordion-heading">
        <a class="accordion-toggle" data-toggle="collapse" href=""></a>
      </div>
      <div id="" class="accordion-body collapse">
        <div class="accordion-inner">
          <p></p>
        </div>
      </div>
    </div>

  </div>
  <!-- end question group 1 -->

</div>

<script type="text/javascript">
    var search_trans = {
      'adeptio': '<img src="assets/coins-logo/Adeptio.png" alt="coin" style="width:32px;height:32px;">' + ' ' + ' Adeptio (ADE)',
      'bitcoin': '<img src="assets/coins-logo/Bitcoin.png" alt="coin" style="width:32px;height:32px;">' + ' ' + ' Bitcoin (BTC)',
      'litecoin': '<img src="assets/coins-logo/Litecoin.png" alt="coin" style="width:32px;height:32px;">' + ' ' + ' Litecoin (LTC)',
      'dash': '<img src="assets/coins-logo/Dash.png" alt="coin" style="width:32px;height:32px;">' + ' ' + ' Dash (DASH)',
      'zcoin': '<img src="assets/coins-logo/Zcoin.png" alt="coin" style="width:32px;height:32px;">' + ' ' + ' Zcoin (XZC)',
      'ravencoin': '<img src="assets/coins-logo/Ravencoin.png" alt="coin" style="width:32px;height:32px;">' + ' ' + ' Ravencoin (RVN) ',
      'polis': '<img src="assets/coins-logo/Polis.png" alt="coin" style="width:32px;height:32px;">' + ' ' + ' Polis (POLIS) ',
      'pivx': '<img src="assets/coins-logo/Pivx.png" alt="coin" style="width:32px;height:32px;">' + ' ' + ' Pivx (PIVX) ',
      'ontology': '<img src="assets/coins-logo/Ontology.png" alt="coin" style="width:32px;height:32px;">' + ' ' + ' Ontology (ONT) ',
      'snowgem': '<img src="assets/coins-logo/Snowgem.png" alt="coin" style="width:32px;height:32px;">' + ' ' + ' Snowgem (XSG) ',
      'syscoin': '<img src="assets/coins-logo/Syscoin.png" alt="coin" style="width:32px;height:32px;">' + ' ' + ' Syscoin (SYS) ',
      'bitcoin-cash': '<img src="assets/coins-logo/BitcoinCash.png" alt="coin" style="width:32px;height:32px;">' + ' ' + ' BitcoinCash (BCH) ',
      
      'block': 'Block',
      'moneysupply': 'Money Supply',
      'previousblockhash': 'Previous Block Hash',
      'nextblockhash': 'Next Block Hash',
      'chainwork': 'Chainwork',
      'bits': 'Bits',
      'time': 'UnixTime',
      'hash': 'Block Hash',
      'confirmations': 'Confirmations',
      'strippedsize': 'StrippedSize (bytes)',
      'nTx': 'NumberOfTransactions',
      'mediantime': 'MedianTime',
      'versionHex': 'VersionHex',
      'weight': 'Weight',
      'size': 'Size (bytes)',
      'version': 'Version',
      'merkleroot': 'Merkleroot',
      'acc_checkpoint': 'Acc-checkpoint',
      'tx': 'Transactions',
      'height': 'BlockHeight',
      'difficulty': 'Difficulty',
    };

    function result_value(key, value) 
    {
      switch(key) {
        case 'hash':
          return '<a href="buratinas" target="_blank">' + value + '</a>';
          break;
        case 'time':
          return value + ' sec';
          break;
        default:
          return value;
      } 
    }

    function result_line(key, value) 
    {
      return '<div class="row"><div class="span2"><b>' + search_translate(key) + '</b>: </div><div class="span9">' + result_value(key, value) + '</div></div>';
    }

    function show_error(error) {
      $("#search-error").find(".text-error").text(error);
      if($("#search-error").hasClass("hidden"))
        $("#search-error").removeClass("hidden");
      if(!$("#search-result").hasClass("hidden"))
        $("#search-result").addClass("hidden");
    }

    function show_result() {
      if(!$("#search-error").hasClass("hidden"))
        $("#search-error").addClass("hidden");
      if($("#search-result").hasClass("hidden"))
        $("#search-result").removeClass("hidden");
    }

    function search_translate(key, def) {
      var name = key;
      if(name in search_trans)
        name = search_trans[name];
      return name;
    }

    if(!getUrlParamByName('query')) {
      show_error('No data');
    } else

    $.ajax(
    {
      //url: "/parsedb.json",
      url: "/parsedb?query="+getUrlParamByName('query'),
      dataType: "text", 
      success: function(json)
      {
        json = FixJson(json);

        if(!json || !json['ProcessingTook']) {
          show_error('Not found');
          return
        }

        if(json['FATAL']) {
          show_error(json['FATAL']);
          return
        }

        show_result();

        $("#search-ProcessingTook").find(".value").text(json['ProcessingTook']);

        $.each(json['SearchData'], function(i, blockchain)
        {
          var s = 1;
          var id = 'search-blockchain-'+i;
          var div = $("#copy-search-tab").clone();
          var count = Object.keys(blockchain).length;

          div.attr("id","");
          div.removeClass("hidden");
          div.find('.accordion-toggle').attr("href", '#'+id).html(search_translate(blockchain['FoundDataIn']));
          div.find('.accordion-body').attr("id", id);
          var description = div.find('.accordion-inner p');

          $.each(blockchain, function(key, value)
          {
             description.append(result_line(key, value));

            if (s === count) { // this will be executed at the end of the loop
                div.appendTo('#search-tab');
            }s++;
          });
        });
      },
      error: function(xhr, ajaxOptions, thrownError) {
        show_error(thrownError);
      }
    });
</script>
