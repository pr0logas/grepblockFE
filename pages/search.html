<div id="search-error" class="alert alert-error hidden">
  <span class="label label-info">FATAL</span><p class="text-error"></p>
</div>

<div id="search-result" class="hidden">
  <div id="search-ProcessingTook"><span class="name">ProcessingTook: </span><span class="value"></span></div>

  <div class="accordion botspacer40" id="search-tab">

    <div id="copy-search-tab" class="accordion-group hidden">
      <div class="accordion-heading">
        <a class="accordion-toggle" data-toggle="collapse" href=""></a>
      </div>
      <div id="" class="accordion-body collapse in">
        <div class="accordion-inner">
          <p></p>
        </div>
      </div>
    </div>

  </div>
  <!-- end question group 1 -->

</div>

<script type="text/javascript">
    var search_trans = {
      'block': 'BlOcK',
      'tx': 'Some TX',
      'height': 'HeiGht',
      'difficulty': 'DifficultY',
    };

    function result_line(key, value) 
    {
      var name = key;
      if(name in search_trans)
        name = search_trans[name];

      return '<b>' + name + '</b>: ' + value + '<br>';
    }

    function show_error(error) {
      $("#search-error").find(".text-error").text(error);
      if($("#search-error").hasClass("hidden"))
        $("#search-error").removeClass("hidden");
      if(!$("#search-result").hasClass("hidden"))
        $("#search-result").addClass("hidden");
    }

    if(!getUrlParamByName('query')) {
      show_error('No data');
    } else

    $.ajax(
    {
      url: "/parsedb.json",
      //url: "/parsedb?query="+getUrlParamByName('query'),

      success: function(json)
      {
        if(!json || !json['ProcessingTook']) {
          show_error('Not found');
          return
        }

        if(json['FATAL']) {
          show_error(json['FATAL']);
          return
        }

        if(!$("#search-error").hasClass("hidden"))
          $("#search-error").addClass("hidden");
        if($("#search-result").hasClass("hidden"))
          $("#search-result").removeClass("hidden");

        $("#search-ProcessingTook").find(".value").text(json['ProcessingTook']);

        $.each(json['SearchData'], function(i, blockchain)
        {
          var i = 1;
          var id = 'search-blockchain-'+i;
          var div = $("#copy-search-tab").clone();
          var count = Object.keys(blockchain).length;

          div.attr("id","");
          div.removeClass("hidden");
          div.find('.accordion-toggle').attr("href", '#'+id).html(blockchain['FoundDataIn']);
          div.find('.accordion-body').attr("id", id);
          var description = div.find('.accordion-inner p');

          $.each(blockchain, function(key, value)
          {
             description.append(result_line(key, value));

            if (i === count) { // this will be executed at the end of the loop
                div.appendTo('#search-tab');
            }i++;
          });
        });
      },
      error: function(xhr, ajaxOptions, thrownError) {
        show_error(thrownError);
      }
    });
</script>
